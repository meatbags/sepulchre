var Collider=function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=6)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(8);Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})});var o=i(9);Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=2*Math.PI,o=function(t){return new THREE.Vector3(t.x,t.y,t.z)},s=function(t,e){return new THREE.Vector3(t.x+e.x,t.y+e.y,t.z+e.z)},r=function(t,e){return new THREE.Vector3((t.x+e.x)/2,(t.y+e.y)/2,(t.z+e.z)/2)},a=function(t,e){return new THREE.Vector3(t.x-e.x,t.y-e.y,t.z-e.z)},h=function(t,e){return new THREE.Vector3(t.x*e.x,t.y*e.y,t.z*e.z)},l=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==e?new THREE.Vector3(0,0,0):new THREE.Vector3(t.x/e,t.y/e,t.z/e)},c=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return 0==e?new THREE.Vector2(0,0):new THREE.Vector2(t.x/e,t.y/e)},u=function(t){return t.x*=-1,t.y*=-1,t.z*=-1,t},f=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))},p=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.z-t.z,2))},y=function(t,e){var i=p(t,e),n=e.y-t.y;return Math.atan2(n,i)},d=function(t,e){return new THREE.Vector3(t.x*e,t.y*e,t.z*e)},m=function(t,e){return new THREE.Vector3(t.x*e.x,t.y*e.y,t.z*e.z)},v=function(t,e){return t.x===e.x&&t.y===e.y&t.z===e.z},g=function(t,e){return new THREE.Vector3(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},b=function(t,e){return Math.atan2(Math.sin(e-t),Math.cos(e-t))},x=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},w=function(t,e){return t.x*e.x+t.y*e.y};e.addVector=s,e.averageVectors=r,e.copyVector=o,e.crossProduct=g,e.distanceBetween=f,e.distanceBetween2D=p,e.dotProduct=x,e.dotProduct2=w,e.isVectorEqual=v,e.minAngleDifference=b,e.mulVector=h,e.normalise=l,e.normalise2=c,e.pitchBetween=y,e.reverseVector=u,e.subtractVector=a,e.scaleVector=d,e.scaleByVector=m,e.twoPi=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1);Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})})},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Mesh=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=(i(0),i(10)),r=i(4),a=i(11),h=i(2),l=function(){function t(e){if(n(this,t),!e.geometry.isBufferGeometry)throw"Error: THREE.BufferGeometry not found";this.id=e.uuid,this.isColliderMesh=!0,this.object=e,this.geometry=e.geometry,this.box=new r.Box(e),this.planes=[],this.transform=new a.Transformer(e),this.generatePlanes(),this.conformPlanes()}return o(t,[{key:"generatePlanes",value:function(){var t=this.geometry.attributes.position.array,e=this.geometry.attributes.normal.array;if(this.geometry.index)for(var i=this.geometry.index.array,n=this.geometry.attributes.position.itemSize,o=0;o<i.length;o+=3){var r=i[o]*n,a=i[o+1]*n,h=i[o+2]*n;this.planes.push(new s.Plane(new THREE.Vector3(t[r],t[r+1],t[r+2]),new THREE.Vector3(t[a],t[a+1],t[a+2]),new THREE.Vector3(t[h],t[h+1],t[h+2]),new THREE.Vector3(e[r],e[r+1],e[r+2]),new THREE.Vector3(e[a],e[a+1],e[a+2]),new THREE.Vector3(e[h],e[h+1],e[h+2])))}else for(var l=0;l<t.length;l+=9)this.planes.push(new s.Plane(new THREE.Vector3(t[l+0],t[l+1],t[l+2]),new THREE.Vector3(t[l+3],t[l+4],t[l+5]),new THREE.Vector3(t[l+6],t[l+7],t[l+8]),new THREE.Vector3(e[l+0],e[l+1],e[l+2]),new THREE.Vector3(e[l+3],e[l+4],e[l+5]),new THREE.Vector3(e[l+6],e[l+7],e[l+8])))}},{key:"conformPlanes",value:function(){var t=!1;if(!this.transform.default.scale){for(var e=0;e<this.planes.length;e+=1)this.transform.bakeScale(this.planes[e]);t=!0}if(!this.transform.default.rotation){for(var i=0;i<this.planes.length;i+=1)this.transform.bakeRotation(this.planes[i]);t=!0}if(t)for(var n=0;n<this.planes.length;n+=1)this.planes[n].generatePlane();this.setBoxFromPlanes()}},{key:"setBoxFromPlanes",value:function(){for(var t=[],e=0,i=this.planes.length;e<i;++e){var n=this.planes[e];t.push(n.p1),t.push(n.p2),t.push(n.p3)}this.box.setFromPoints(t),this.updateBoxPosition()}},{key:"updateBoxPosition",value:function(){this.box.setPosition(this.transform.getPosition())}},{key:"getCollision",value:function(t){if(this.box.containsPoint(t)){this.transform.set(t);for(var e=0,i=this.planes.length;e<i;++e)this.planes[e].culled=!1;for(var e=0,i=this.planes.length;e<i;++e)if(!this.planes[e].culled&&this.planes[e].isPointBelowOrEqual(this.transform.point))for(var n=0,o=this.planes.length;n<o;++n)!this.planes[n].culled&&n!=e&&this.planes[e].isPlaneAbove(this.planes[n])&&(this.planes[n].culled=!0);for(var e=0,i=this.planes.length;e<i;++e)if(!this.planes[e].culled&&!this.planes[e].isPointBelowOrEqual(this.transform.point))return!1;return!0}return!1}},{key:"getCeilingPlane",value:function(t){this.transform.set(t);for(var e=null,i=0,n=this.planes.length;i<n;i+=1)if(this.planes[i].containsPoint2D(this.transform.point)&&this.planes[i].projectedTriangleContainsPoint2D(this.transform.point)&&this.planes[i].isPointBelowOrEqual(this.transform.point)){var o=this.planes[i].getY(this.transform.point.x,this.transform.point.z);null!=o&&o>=this.transform.point.y&&(null==e||o>e.y)&&(e={y:o,plane:this.planes[i]})}return null==e?null:{y:this.transform.getReverseTransformedY(e.y),plane:e.plane}}},{key:"getIntersectPlane",value:function(t,e){for(var i=this.transform.getTransformedPoint(t),n=this.transform.getTransformedPoint(e),o=(new THREE.Box3).setFromPoints([i,n]),s=null,r=0;r<this.planes.length;r+=1)if(this.planes[r].intersectsBox(o)||this.planes[r].containsBox(o)){var a=this.planes[r].getIntersect(i,n);if(null!=a){var l=(0,h.distanceBetween)(i,a);(null===s||l<s.distance)&&(s={intersect:a,plane:this.planes[r],distance:l})}}return null==s?null:{intersect:this.transform.getReverseTransformedPoint(s.intersect),plane:s.plane,distance:s.distance}}},{key:"getIntersectPlane2D",value:function(t,e){for(var i=this.transform.getTransformedPoint(t),n=this.transform.getTransformedPoint(e),o=(new THREE.Box3).setFromPoints([i,n]),s=null,r=0;r<this.planes.length;r+=1)if(this.planes[r].intersectsBox(o)||this.planes[r].containsBox(o)){var a=this.planes[r].getNormalIntersect2D(n);if(null!=a){var l=(0,h.distanceBetween)(n,a);(null===s||l<s.distance)&&(s={plane:this.planes[r],intersect:a,distance:l})}}return null==s?null:{intersect:this.transform.getReverseTransformedPoint(s.intersect),plane:s.plane,distance:s.distance}}},{key:"getProjected",value:function(t,e){var i=this.transform.getTransformedPoint(t),n=e.getProjected(i);return this.transform.getReverseTransformedPoint(n)}}]),t}();e.Mesh=l},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Box=void 0;var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(2),h=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.setFromBufferAttribute(t.geometry.attributes.position),i.position=new THREE.Vector3,i}return s(e,t),r(e,[{key:"setPosition",value:function(t){(0,a.isVectorEqual)(this.position,t)||(this.translate((0,a.subtractVector)(t,this.position)),this.position=t.clone())}}]),e}(THREE.Box3);e.Box=h},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Collider=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(0),r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),h=function(){function t(e,i){n(this,t),this.position=e,this.motion=i,this.config=s.Physics}return o(t,[{key:"setPhysics",value:function(t){for(var e in t)t.hasOwnProperty(e)&&this.config.hasOwnProperty(e)&&(this.config[e]=t[e])}},{key:"applyPhysics",value:function(t){this.falling=this.motion.y<0,this.motion.y=Math.max(this.motion.y-this.config.gravity*t,-this.config.maxVelocity)}},{key:"move",value:function(t,e){var i=a.addVector(this.position,a.scaleVector(this.motion,t));this.applyPhysics(t);var n=e.getCollisionMeshes(i);n.length>0?(this.stepUpSlopes(i,n)&&(n=e.getCollisionMeshes(i)),this.extrudeFrom(i,n,e)&&this.stepUpSlopes(i,e.getCollisionMeshes(i))):this.motion.y<0&&!this.falling&&this.stepDownSlope(i,e.getCeilingPlane(new THREE.Vector3(i.x,i.y-this.config.snapDown,i.z))),i.y<this.config.floor&&(this.motion.y=0,i.y=this.config.floor),this.position.copy(i)}},{key:"getValidCollisions",value:function(t,e){for(var i=0,n=0,o=e.length;n<o;++n){var s=e[n].getCeilingPlane(t);null!=s&&(s.plane.normal.y<this.config.minSlope||s.y-this.position.y>this.config.snapUp)&&i++}return i}},{key:"extrudeFrom",value:function(t,e,i){for(var n=!1,o=!1,s=0,r=e.length;s<r;++s){var a=e[s].getCeilingPlane(t);if(null!=a&&(a.plane.normal.y<this.config.minSlope||a.y-this.position.y>this.config.snapUp)){o=e[s];break}}if(o){var h=o.getIntersectPlane2D(this.position,t);if(null!=h){var l=h.intersect,c=h.plane;if(c.normal.y<-.5){var u=o.getProjected(t,c);this.getValidCollisions(u,i.getCollisionMeshes(u))>1?(t.x=this.position.x,t.z=this.position.z):(t.x=u.x,t.y=u.y,t.z=u.z,this.motion.y=this.motion.y>0?.75*this.motion.y:this.motion.y,n=!0)}else{t.x=l.x,t.z=l.z;this.getValidCollisions(t,i.getCollisionMeshes(t))>1?(t.x=this.position.x,t.z=this.position.z):n=!0}}else t.x=this.position.x,t.z=this.position.z}return n}},{key:"stepUpSlopes",value:function(t,e){for(var i=!1,n=0,o=e.length;n<o;++n){var s=e[n].getCeilingPlane(t);null!=s&&s.plane.normal.y>=this.config.minSlope&&s.y-this.position.y<=this.config.snapUp&&s.y>=t.y&&(i=!0,t.y=s.y,this.motion.y=0)}return i}},{key:"stepDownSlope",value:function(t,e){var i=!1;return null!=e&&e.plane.normal.y>=this.config.minSlope&&(t.y=e.y,this.motion.y=0,i=!0),i}}]),t}();e.Collider=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7);Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})});var o=i(14);Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(3);Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})});var o=i(12);Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),window.mobileAndTabletcheck=function(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t};var n={isMobile:window.mobileAndTabletcheck(),system:{maxPlanesPerMesh:250},quadrants:{size:{x:100,y:100,z:100}},plane:{dotBuffer:.001,collisionThreshold:.5},sandbox:{player:{height:2,position:{x:0,y:0,z:0},rotation:{pitch:0,yaw:Math.PI,roll:0,maxPitch:.3*Math.PI,minPitch:-.3*Math.PI},speed:{normal:8,slowed:4,noclip:30,rotation:.75*Math.PI,jump:10,fallTimerThreshold:.2}},camera:{fov:75,aspect:1,near:.1,far:1e3},adjust:{verySlow:.01,slow:.025,normal:.05,fast:.09,rapid:.12,veryFast:.2}}};e.Config=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={gravity:18,maxVelocity:50,friction:.5,floor:0,snapUp:.75,snapDown:.5,minSlope:Math.PI/5,noclip:!1};e.Physics=n},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Plane=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(s),a=i(0),h=function(){function t(e,i,o,s,r,a){n(this,t),this.p1=e,this.p2=i,this.p3=o,this.n1=s,this.n2=r,this.n3=a,this.culled=!1,this.generatePlane()}return o(t,[{key:"generatePlane",value:function(){this.e1={},this.e2={},this.e3={},this.e1.centre=r.scaleVector(r.addVector(this.p1,this.p2),.5),this.e2.centre=r.scaleVector(r.addVector(this.p2,this.p3),.5),this.e3.centre=r.scaleVector(r.addVector(this.p3,this.p1),.5),this.e1.vec=r.subtractVector(this.p2,this.p1),this.e2.vec=r.subtractVector(this.p3,this.p2),this.e3.vec=r.subtractVector(this.p1,this.p3),this.e1.vec2=new THREE.Vector2(this.e1.vec.x,this.e1.vec.z),this.e2.vec2=new THREE.Vector2(this.e2.vec.x,this.e2.vec.z),this.e3.vec2=new THREE.Vector2(this.e3.vec.x,this.e3.vec.z),this.e1.norm2=new THREE.Vector2(-this.e1.vec.z,this.e1.vec.x),this.e2.norm2=new THREE.Vector2(-this.e2.vec.z,this.e2.vec.x),this.e3.norm2=new THREE.Vector2(-this.e3.vec.z,this.e3.vec.x),this.normal=r.normalise(r.crossProduct(this.e3.vec,this.e1.vec)),this.normalXZ=new THREE.Vector3(this.normal.x,0,this.normal.z),r.dotProduct(this.normal,this.n1)<0&&r.dotProduct(this.normal,this.n2)<0&&r.dotProduct(this.normal,this.n3)<0&&(this.normal=r.reverseVector(this.normal)),this.position=new THREE.Vector3((this.p1.x+this.p2.x+this.p3.x)/3,(this.p1.y+this.p2.y+this.p3.y)/3,(this.p1.z+this.p2.z+this.p3.z)/3),this.D=-this.normal.x*this.position.x-this.normal.y*this.position.y-this.normal.z*this.position.z,this.box=(new THREE.Box3).setFromPoints([this.p1,this.p2,this.p3])}},{key:"getY",value:function(t,e){return 0!=this.normal.y?(this.normal.x*t+this.normal.z*e+this.D)/-this.normal.y:null}},{key:"isPlaneAbove",value:function(t){return this.isPointAboveOrEqual(t.p1)&&this.isPointAboveOrEqual(t.p2)&&this.isPointAboveOrEqual(t.p3)}},{key:"isPointAboveOrEqual",value:function(t){return r.dotProduct(r.subtractVector(t,this.position),this.normal)>=-a.Config.plane.dotBuffer}},{key:"isPointBelowOrEqual",value:function(t){return r.dotProduct(r.subtractVector(t,this.position),this.normal)<=a.Config.plane.dotBuffer}},{key:"containsBox",value:function(t){return this.box.containsBox(t)}},{key:"intersectsBox",value:function(t){return this.box.intersectsBox(t)}},{key:"containsPoint2D",value:function(t){return this.box.min.x<=t.x&&this.box.max.x>=t.x&&this.box.min.z<=t.z&&this.box.max.z>=t.z}},{key:"projectedTriangleContainsPoint2D",value:function(t){return r.dotProduct2({x:t.x-this.e1.centre.x,y:t.z-this.e1.centre.z},this.e1.norm2)<a.Config.plane.dotBuffer&&r.dotProduct2({x:t.x-this.e2.centre.x,y:t.z-this.e2.centre.z},this.e2.norm2)<a.Config.plane.dotBuffer&&r.dotProduct2({x:t.x-this.e3.centre.x,y:t.z-this.e3.centre.z},this.e3.norm2)<a.Config.plane.dotBuffer}},{key:"distanceToPlane",value:function(t){return Math.abs(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.D)}},{key:"getProjected",value:function(t){var e=r.subtractVector(t,this.p1),i=r.dotProduct(this.normal,e);return r.subtractVector(t,r.scaleVector(this.normal,i))}},{key:"getIntersect",value:function(t,e){var i=r.subtractVector(e,t),n=r.dotProduct(this.normal,r.normalise(i));if(Math.abs(n)<=a.Config.plane.dotBuffer)return null;var o=this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.D,s=this.normal.x*i.x+this.normal.y*i.y+this.normal.z*i.z;if(0==s)return null;var h=t.x-i.x*o/s,l=t.y-i.y*o/s,c=t.z-i.z*o/s,u=new THREE.Vector3(h,l,c);if(this.box.containsPoint(u)){if((new THREE.Box3).setFromPoints([e,t]).expandByScalar(.05).containsPoint(u))return u}return null}},{key:"getNormalIntersect",value:function(t){var e=r.addVector(t,this.normal),i=r.subtractVector(e,t),n=this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.D,o=this.normal.x*i.x+this.normal.y*i.y+this.normal.z*i.z,s=t.x-i.x*n/o,a=t.y-i.y*n/o,h=t.z-i.z*n/o;return new THREE.Vector3(s,a,h)}},{key:"getNormalIntersect2D",value:function(t){var e=this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.D,i=this.normal.x*this.normal.x+this.normal.z*this.normal.z;return 0==i?null:new THREE.Vector3(t.x-this.normal.x*e/i,t.y,t.z-this.normal.z*e/i)}},{key:"getPerpendicularNormals",value:function(){return{right:new THREE.Vector3(-this.normal.z,0,this.normal.x),left:new THREE.Vector3(this.normal.z,0,-this.normal.x)}}}]),t}();e.Plane=h},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Transformer=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(2),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(s),a=function(){function t(e){n(this,t),this.point=new THREE.Vector3,this.position=e.position,this.rotation=e.rotation,this.scale=e.scale,this.rotationOrder=e.rotation.order.split(""),this.axis={x:new THREE.Vector3(1,0,0),y:new THREE.Vector3(0,1,0),z:new THREE.Vector3(0,0,1)},this.checkDefault()}return o(t,[{key:"set",value:function(t){this.point.x=t.x-this.position.x,this.point.y=t.y-this.position.y,this.point.z=t.z-this.position.z}},{key:"getTransformedPoint",value:function(t){return{x:t.x-this.position.x,y:t.y-this.position.y,z:t.z-this.position.z}}},{key:"getReverseTransformedPoint",value:function(t){return{x:t.x+this.position.x,y:t.y+this.position.y,z:t.z+this.position.z}}},{key:"getReverseTransformedY",value:function(t){return t+this.position.y}},{key:"getPosition",value:function(){return this.position}},{key:"bakeRotation",value:function(t){for(var e=this.rotationOrder.length-1;e>-1;--e)"X"==this.rotationOrder[e]?(t.p1.applyAxisAngle(this.axis.x,this.rotation.x),t.p2.applyAxisAngle(this.axis.x,this.rotation.x),t.p3.applyAxisAngle(this.axis.x,this.rotation.x),t.n1.applyAxisAngle(this.axis.x,this.rotation.x),t.n2.applyAxisAngle(this.axis.x,this.rotation.x),t.n3.applyAxisAngle(this.axis.x,this.rotation.x)):"Y"==this.rotationOrder[e]?(t.p1.applyAxisAngle(this.axis.y,this.rotation.y),t.p2.applyAxisAngle(this.axis.y,this.rotation.y),t.p3.applyAxisAngle(this.axis.y,this.rotation.y),t.n1.applyAxisAngle(this.axis.y,this.rotation.y),t.n2.applyAxisAngle(this.axis.y,this.rotation.y),t.n3.applyAxisAngle(this.axis.y,this.rotation.y)):"Z"==this.rotationOrder[e]&&(t.p1.applyAxisAngle(this.axis.z,this.rotation.z),t.p2.applyAxisAngle(this.axis.z,this.rotation.z),t.p3.applyAxisAngle(this.axis.z,this.rotation.z),t.n1.applyAxisAngle(this.axis.z,this.rotation.z),t.n2.applyAxisAngle(this.axis.z,this.rotation.z),t.n3.applyAxisAngle(this.axis.z,this.rotation.z))}},{key:"bakeScale",value:function(t){t.p1=r.scaleByVector(t.p1,this.scale),t.p2=r.scaleByVector(t.p2,this.scale),t.p3=r.scaleByVector(t.p3,this.scale)}},{key:"checkDefault",value:function(){this.default={position:0==this.position.x&&0==this.position.y&&0==this.position.z,rotation:0==this.rotation.x&&0==this.rotation.y&&0==this.rotation.z,scale:1==this.scale.x&&1==this.scale.y&&1==this.scale.z}}}]),t}();e.Transformer=a},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.System=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(0),r=i(3),a=i(13),h=function(){function t(){n(this,t),this.isColliderSystem=!0,this.map=new a.Map,this.meshes=[]}return o(t,[{key:"add",value:function(){for(var t=0,e=arguments.length;t<e;++t){var i=arguments[t];if(i.isColliderMesh)this.appendMesh(i);else{if(!i.geometry||!i.geometry.isBufferGeometry)throw"Error: Mesh must be THREE.Mesh or Collider.Mesh";this.appendMesh(new r.Mesh(i))}}}},{key:"appendMesh",value:function(t){t.planes.length<=s.Config.system.maxPlanesPerMesh?(this.map.add(t),this.meshes.push(t.object)):console.warn("Warning: Mesh discluded. Plane count exceeds maximum (%s).",s.Config.system.maxPlanesPerMesh)}},{key:"getCollision",value:function(t){for(var e=!1,i=this.map.getMeshes(t),n=0,o=i.length;n<o;++n)if(i[n].getCollision(t)){e=!0;break}return e}},{key:"getCollisionMeshes",value:function(t){for(var e=[],i=this.map.getMeshes(t),n=0,o=i.length;n<o;++n)i[n].getCollision(t)&&e.push(i[n]);return e}},{key:"getCeilingPlane",value:function(t){for(var e=null,i=this.map.getMeshes(t),n=0,o=i.length;n<o;++n)if(i[n].getCollision(t)){var s=i[n].getCeilingPlane(t);s&&(!e||s.y>e.y)&&(e={y:s.y,plane:s.plane})}return e}},{key:"getMeshes",value:function(){return this.meshes}}]),t}();e.System=h},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Map=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=(i(0),i(4),function(){function t(){n(this,t),this.origin=new THREE.Vector3,this.radius=10,this.threshold=this.radius-1,this.meshes=[],this.nearby=[]}return o(t,[{key:"add",value:function(t){this.meshes.push(t),this.cacheNearbyMeshes()}},{key:"getMeshes",value:function(t){return this.origin.distanceTo(t)>=this.threshold&&(this.origin.copy(t),this.cacheNearbyMeshes()),this.nearby}},{key:"cacheNearbyMeshes",value:function(){this.nearby=[];for(var t=0,e=this.meshes.length;t<e;++t){this.meshes[t].updateBoxPosition();this.meshes[t].box.distanceToPoint(this.origin);this.meshes[t].box.distanceToPoint(this.origin)<=this.radius&&this.nearby.push(this.meshes[t])}}}]),t}());e.Map=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(5);Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})});var o=i(15);Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})})},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(s),a=i(5),h=i(0),l=i(16),c=function(){function t(e){n(this,t),this.domElement=e,this.isMobile=h.Config.isMobile,this.config=h.Config.sandbox.player,this.config.adjust=h.Config.sandbox.adjust,this.config.physics=h.Physics,this.minPitch=this.config.rotation.minPitch,this.maxPitch=this.config.rotation.maxPitch,this.position=new THREE.Vector3(this.config.position.x,this.config.position.y,this.config.position.z),this.rotation={pitch:this.config.rotation.pitch,yaw:this.config.rotation.yaw,roll:this.config.rotation.roll},this.motion=new THREE.Vector3(0,0,0),this.offset={rotation:{pitch:0,yaw:0,roll:0}},this.target={position:new THREE.Vector3(this.config.position.x,this.config.position.y,this.config.position.z),rotation:{pitch:this.config.rotation.pitch,yaw:this.config.rotation.yaw,roll:this.config.rotation.roll},motion:new THREE.Vector3(0,0,0),offset:{rotation:{pitch:0,yaw:0,roll:0}}},this.falling=!1,this.fallTimer=0,this.collider=new a.Collider(this.target.position,this.motion),this.object=new THREE.Group,this.light=new THREE.PointLight(16777215,.1),this.light.position.y=1,this.object.add(this.light),this.camera=new THREE.PerspectiveCamera(h.Config.sandbox.camera.fov,h.Config.sandbox.camera.aspect,h.Config.sandbox.camera.near,h.Config.sandbox.camera.far),this.camera.up=new THREE.Vector3(0,1,0),this.events(),this.resizeCamera()}return o(t,[{key:"update",value:function(t,e){this.input(t),this.collider.move(t,e),this.move()}},{key:"input",value:function(t){if(this.keyboard.keys.left||this.keyboard.keys.right){var e=(this.keyboard.keys.left?1:0)+(this.keyboard.keys.right?-1:0);this.target.rotation.yaw+=this.config.speed.rotation*t*e}if(this.keyboard.keys.up||this.keyboard.keys.down){var i=this.config.physics.noclip?this.config.speed.noclip*(1-Math.abs(Math.sin(this.target.rotation.pitch))):this.config.speed.normal,n=(this.keyboard.keys.up?1:0)+(this.keyboard.keys.down?-1:0),o=this.rotation.yaw+this.offset.rotation.yaw,s=Math.sin(o)*i*n,r=Math.cos(o)*i*n;this.target.motion.x=s,this.target.motion.z=r}else this.target.motion.x=0,this.target.motion.z=0;if(this.keyboard.keys.jump&&((0==this.motion.y||this.fallTimer<this.config.speed.fallTimerThreshold)&&(this.motion.y=this.config.speed.jump,this.fallTimer=this.config.speed.fallTimerThreshold),this.keyboard.releaseKey("jump")),this.falling=0!=this.motion.y,this.fallTimer=this.falling?this.fallTimer+t:0,this.keyboard.keys.x&&(this.keyboard.releaseKey("x"),this.config.physics.noclip=0==this.config.physics.noclip),this.config.physics.noclip){if(this.keyboard.keys.up||this.keyboard.keys.down){var a=(this.keyboard.keys.up?1:0)+(this.keyboard.keys.down?-1:0),h=this.target.rotation.pitch;this.target.motion.y=Math.sin(h)*this.config.speed.noclip*a}else this.target.motion.y=0;this.falling=!1,this.motion.y=this.target.motion.y}this.falling?(this.motion.x+=(this.target.motion.x-this.motion.x)*this.config.adjust.slow,this.motion.z+=(this.target.motion.z-this.motion.z)*this.config.adjust.slow):(this.motion.x=this.target.motion.x,this.motion.z=this.target.motion.z)}},{key:"move",value:function(){this.position.x+=(this.target.position.x-this.position.x)*this.config.adjust.veryFast,this.position.y+=(this.target.position.y-this.position.y)*this.config.adjust.veryFast,this.position.z+=(this.target.position.z-this.position.z)*this.config.adjust.veryFast,this.rotation.yaw+=r.minAngleDifference(this.rotation.yaw,this.target.rotation.yaw)*this.config.adjust.fast,this.offset.rotation.yaw+=(this.target.offset.rotation.yaw-this.offset.rotation.yaw)*this.config.adjust.normal,this.rotation.yaw+=this.rotation.yaw<0?r.twoPi:this.rotation.yaw>r.twoPi?-r.twoPi:0,this.rotation.pitch+=(this.target.rotation.pitch-this.rotation.pitch)*this.config.adjust.normal,this.offset.rotation.pitch+=(this.target.offset.rotation.pitch-this.offset.rotation.pitch)*this.config.adjust.normal,this.rotation.roll+=(this.target.rotation.roll-this.rotation.roll)*this.config.adjust.fast;var t=this.rotation.pitch+this.offset.rotation.pitch,e=this.rotation.yaw+this.offset.rotation.yaw,i=this.position.y+this.config.height,n=1-Math.abs(Math.sin(t));this.camera.up.z=-Math.sin(this.rotation.yaw)*this.rotation.roll,this.camera.up.x=Math.cos(this.rotation.yaw)*this.rotation.roll,this.camera.position.set(this.position.x-Math.sin(e)*n*.25,i-1*Math.sin(t)*.25,this.position.z-Math.cos(e)*n*.25),this.camera.lookAt(new THREE.Vector3(this.position.x+Math.sin(e)*n,i+1*Math.sin(t),this.position.z+Math.cos(e)*n)),this.object.position.set(this.position.x,this.position.y,this.position.z)}},{key:"resizeCamera",value:function(){var t=this.domElement.getBoundingClientRect(),e=t.width,i=t.height;this.camera.aspect=e/i,this.camera.updateProjectionMatrix()}},{key:"events",value:function(){var t=this;this.mouse=new l.Mouse(this.domElement),this.onMouseDown=function(e){t.mouse.isLocked()||t.mouse.start(e,t.rotation.pitch,t.rotation.yaw)},this.onMouseMove=function(e){!t.mouse.isActive()||t.keyboard.keys.left||t.keyboard.keys.right||(t.mouse.move(e),t.target.rotation.yaw=t.mouse.getYaw(),t.target.rotation.pitch=t.mouse.getPitch(t.minPitch,t.maxPitch))},this.onMouseUp=function(e){t.mouse.stop()},this.domElement.addEventListener("mousedown",function(e){t.onMouseDown(e)}),this.domElement.addEventListener("mousemove",function(e){t.onMouseMove(e)}),this.domElement.addEventListener("mouseup",function(e){t.onMouseUp(e)}),this.domElement.addEventListener("mouseleave",function(e){t.onMouseUp(e)}),this.isMobile&&(this.onMobileDown=function(e){e.touches[0]&&t.onMouseDown(e.touches[0])},this.onMobileMove=function(e){e.touches[0]&&t.onMouseMove(e.touches[0])},this.onMobileUp=function(e){e.touches[0]&&t.onMouseUp(e.touches[0])},this.domElement.addEventListener("touchstart",function(e){t.onMobileDown(e)}),this.domElement.addEventListener("touchmove",function(e){t.onMobileMove(e)}),this.domElement.addEventListener("touchend",function(e){t.onMobileUp(e)}),console.log("Mobile events registered.")),this.keyboard=new l.Keyboard,document.addEventListener("keydown",this.keyboard.onKeyDown,!1),document.addEventListener("keyup",this.keyboard.onKeyUp,!1)}}]),t}();e.Player=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(17);Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})});var o=i(18);Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})});var s=i(19);Object.keys(s).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})})},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(){n(this,t),this.keys={},this._events()}return o(t,[{key:"_events",value:function(){var t=this;this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:t.keys.up=!0;break;case 37:case 65:t.keys.left=!0;break;case 40:case 83:t.keys.down=!0;break;case 39:case 68:t.keys.right=!0;break;case 32:t.keys.jump=!0;break;case 88:t.keys.x=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:t.keys.up=!1;break;case 37:case 65:t.keys.left=!1;break;case 40:case 83:t.keys.down=!1;break;case 39:case 68:t.keys.right=!1}},this.pressKey=function(e){t.keys[e]=!0},this.releaseKey=function(e){t.keys[e]=!1}}}]),t}();e.Keyboard=s},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(){n(this,t),this.cvs=document.createElement("canvas"),this.ctx=this.cvs.getContext("2d"),this.disabled=!1,document.body.appendChild(this.cvs),this.setStyle()}return o(t,[{key:"setStyle",value:function(){this.cvs.style.position="fixed",this.cvs.width=window.innerWidth,this.cvs.style.pointerEvents="none",this.cvs.height=400,this.cvs.style.zIndex=10,this.cvs.style.top=0,this.cvs.style.left=0}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height)}},{key:"format",value:function(t){return Math.floor(10*t)/10}},{key:"formatVector",value:function(t){return this.format(t.x)+", "+this.format(t.y)+", "+this.format(t.z)}},{key:"disable",value:function(){this.disabled=!0}},{key:"print",value:function(){if(!this.disabled){this.clear();for(var t=0;t<arguments.length;t+=1)this.ctx.fillText(arguments[t],20,20+20*t)}}}]),t}();e.Logger=s},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(e){n(this,t),this.domElement=e,this.x=0,this.y=0,this.origin={x:0,y:0},this.delta={x:0,y:0},this.pitch=0,this.yaw=0,this.locked=!1,this.active=!1}return o(t,[{key:"start",value:function(t,e,i){var n=this.domElement.getBoundingClientRect();this.pitch=isNaN(e)?0:e,this.yaw=isNaN(i)?0:i,this.active=!0,this.origin.x=n.width?(t.clientX-n.left)/n.width*2-1:0,this.origin.y=n.height?(t.clientY-n.top)/n.height*2-1:0}},{key:"move",value:function(t){var e=this.domElement.getBoundingClientRect();this.x=(t.clientX-e.left)/e.width*2-1,this.y=(t.clientY-e.top)/e.height*2-1,this.delta.x=this.x-this.origin.x,this.delta.y=this.y-this.origin.y}},{key:"stop",value:function(){this.active=!1}},{key:"getPitch",value:function(t,e){var i=Math.max(t,Math.min(e,this.pitch+this.delta.y));return(i<=t||i>=e)&&(this.origin.y=this.y,this.pitch=pitch),i}},{key:"getYaw",value:function(){return this.yaw+this.delta.x}},{key:"isActive",value:function(){return this.active}},{key:"isLocked",value:function(){return this.locked}}]),t}();e.Mouse=s}]);